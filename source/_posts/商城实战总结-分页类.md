title: '商城实战总结:分页类'
date: 2016-02-22 09:09:56
tags: [BOOL商城,PHP,十八哥]
categories: [PHP学习记录]
---

> 分页类:根据不同的传参显示不同的数据
自动生成导航

<!--more-->
## 1.准备工作:
三个最主要的数据:
$page(当前页),$perpage(每页显示的记录数),$total(总的记录/商品数);
根据上面所计算出来的数据:
总页数 = ceil($total/$perpage)
数据库的起始点:$offset = ($page-1)*perpage;
数据库每次取得的数目:$perpage

## 2.显示数据
根据GET获取到当前页码:
``` php
$page = isset($_GET['page'])?$_GET['page']+0:1;
```
根据当前页码取出起始点:
``` php
$offset = ($page-1)*$perpage;
```
从数据库取出数据:
``` php
	$sql = 'SELECT * FROM table_name LIMIT '.$offset.','.$perpage;
```
## 3.自动生成导航
``` php
Class PageTool{
	private $total = 1;//总记录数目
	private $page = 1;//当前页码
	private $perpage = 10;//每页显示的记录

	Public function __construct($total,$page = false,$perpage = false){
		$this->total = $total;
		// 如果不填写page,默认就不改变
		$this->page = $page?$page:$this->page;
		// 同理
		$this->perpage = $perpage?$perpage:$this->perpage;
	}

	Public function show(){
		// 计算总的页数
		$cnt = ceil($this->total/$this->perpage);

		// 1.取出url并去掉$page
		$uri = $_SERVER['REQUEST_URI'];
		// 2.取出uri中的所有参数
		$parse = parse_url($uri);
		// 将参数格式的字符串解析成数组:
		if(isset($parse['query'])){
			$param = array();
			parse_str($parse['query'],$param);
			//去掉page参数,因为page是我们要自己写的
			unset($param['page']);
		}

		// 取出url
		$url = $parse['path'].'?';

		if (!empty($param)){
			// 将数组转换成传参格式
			$param = http_build_query($param);	
			$url .= $param.'&';
		}

		$nav[0] = '<span class = 'page_now'>'.$this->page.'</span>';
		// 当左边页面小于1,或者右边页面大于5的时候
		// nav中的总数大于5的时候
		for($left = $this->page-1,$right = $this->page+1;($left >=1 || $right <= $cnt) count($nav) <= 5 ;){
			if($left >= 1){
				array_unshift($nav,'a href ="'.$url.'page = '.$left.'">['.$left.']</a>');
				$left -= 1;
			}
			if($right <= $cnt){
				array_push($nav,'<a href="'.$url.'page='.$right.'">['.$right.']</a>');	
				$right +=1;
			}

		}

		return implode('&nbsp;&nbsp;',$nav);
	}
}
```